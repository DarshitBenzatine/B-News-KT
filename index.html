<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B-News Project - Knowledge Transfer</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-elevated: #21262d;
            --border: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --accent-amber: #f59e0b;
            --accent-cyan: #22d3ee;
            --accent-green: #34d399;
            --accent-rose: #fb7185;
            --accent-blue: #60a5fa;
            --accent-violet: #a78bfa;
            --gradient-1: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            --gradient-2: linear-gradient(135deg, #22d3ee 0%, #6366f1 100%);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            --radius: 12px;
            --radius-lg: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Outfit', -apple-system, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.7;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Animated background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, rgba(34, 211, 238, 0.15), transparent),
                radial-gradient(ellipse 60% 40% at 100% 50%, rgba(245, 158, 11, 0.08), transparent),
                radial-gradient(ellipse 60% 40% at 0% 80%, rgba(96, 165, 250, 0.08), transparent);
            pointer-events: none;
            z-index: 0;
        }

        /* Layout: Sidebar + Main Content */
        .app-layout {
            display: flex;
            min-height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Sidebar - Table of Contents */
        .sidebar {
            width: 280px;
            min-width: 280px;
            background: var(--bg-card);
            border-right: 1px solid var(--border);
            position: sticky;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            flex-shrink: 0;
        }

        .sidebar-inner {
            padding: 1.5rem 1rem 2rem;
        }

        .sidebar .toc h2 {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            padding: 0 0.5rem;
            font-weight: 600;
        }

        .sidebar .toc-nav {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .sidebar .toc-nav a {
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.85rem;
            transform: none;
        }

        .sidebar .toc-nav a:hover {
            transform: translateX(4px);
        }

        /* Main Content Area - Full Width */
        .main-content {
            flex: 1;
            min-width: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 2.5rem 3rem;
            position: relative;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 4rem 0 3rem;
            animation: fadeInDown 0.8s ease-out;
        }

        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 400;
        }

        /* Table of Contents - in Sidebar */
        .toc h2 {
            font-size: 0.85rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .toc-nav a {
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toc-nav a:hover {
            background: var(--bg-elevated);
            color: var(--accent-cyan);
        }

        .toc-nav a::before {
            content: '';
            width: 4px;
            height: 4px;
            background: var(--accent-cyan);
            border-radius: 50%;
            opacity: 0;
            transition: var(--transition);
        }

        .toc-nav a:hover::before {
            opacity: 1;
        }

        /* Main content sections */
        .section {
            margin-bottom: 3rem;
            animation: fadeInUp 0.6s ease-out both;
        }

        .section:nth-child(1) { animation-delay: 0.1s; }
        .section:nth-child(2) { animation-delay: 0.15s; }
        .section:nth-child(3) { animation-delay: 0.2s; }
        .section:nth-child(4) { animation-delay: 0.25s; }
        .section:nth-child(5) { animation-delay: 0.3s; }

        .section-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
        }

        .section-card:hover {
            border-color: rgba(34, 211, 238, 0.3);
            box-shadow: var(--shadow-lg);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
        }

        .section-title .icon {
            font-size: 1.25rem;
            opacity: 0.9;
        }

        h3 {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem;
            color: var(--accent-cyan);
        }

        h4 {
            font-size: 1rem;
            font-weight: 600;
            margin: 1rem 0 0.5rem;
            color: var(--text-primary);
        }

        p {
            margin-bottom: 1rem;
            color: var(--text-secondary);
        }

        ul, ol {
            margin: 0 0 1rem 1.5rem;
            color: var(--text-secondary);
        }

        li {
            margin-bottom: 0.5rem;
        }

        strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Code blocks */
        pre {
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.25rem;
            overflow-x: auto;
            margin: 1rem 0;
            position: relative;
        }

        pre code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-primary);
            background: none;
            padding: 0;
        }

        code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9em;
            background: var(--bg-elevated);
            padding: 0.2em 0.5em;
            border-radius: 6px;
            color: var(--accent-cyan);
        }

        /* Copy button */
        .code-block {
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            padding: 0.4rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .copy-btn:hover {
            background: var(--accent-cyan);
            color: var(--bg-dark);
            border-color: var(--accent-cyan);
        }

        /* Badges & tags */
        .badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-critical { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        .badge-important { background: rgba(245, 158, 11, 0.2); color: var(--accent-amber); }
        .badge-supporting { background: rgba(52, 211, 153, 0.2); color: var(--accent-green); }

        /* Flow boxes */
        .flow-box {
            background: var(--bg-elevated);
            border-left: 4px solid var(--accent-cyan);
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .flow-box ol {
            margin: 0;
            padding-left: 1.25rem;
        }

        /* Table styling */
        .table-wrap {
            overflow-x: auto;
            margin: 1rem 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.75rem 1rem;
            text-align: left;
            border: 1px solid var(--border);
        }

        th {
            background: var(--bg-elevated);
            color: var(--accent-cyan);
            font-weight: 600;
        }

        td {
            color: var(--text-secondary);
        }

        /* Hierarchy tree */
        .tree {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            background: var(--bg-elevated);
            padding: 1.25rem;
            border-radius: var(--radius);
            margin: 1rem 0;
            overflow-x: auto;
        }

        .tree .branch { color: var(--accent-amber); }
        .tree .file { color: var(--accent-cyan); }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
        }

        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.6s ease, transform 0.6s ease;
        }

        /* JSON block */
        .json-block {
            background: #0d1117;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem 1.25rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: var(--text-primary);
            overflow-x: auto;
            margin: 1rem 0;
        }

        .json-block .key { color: var(--accent-rose); }
        .json-block .string { color: var(--accent-green); }
        .json-block .number { color: var(--accent-amber); }

        /* Footer */
        .footer {
            text-align: center;
            padding: 3rem 0;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .footer strong {
            color: var(--text-secondary);
        }

        /* Responsive - Mobile: Sidebar becomes top collapsible */
        @media (max-width: 992px) {
            .app-layout { flex-direction: column; }
            .sidebar {
                width: 100%;
                min-width: 100%;
                height: auto;
                max-height: 50vh;
                position: sticky;
                top: 0;
                z-index: 100;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            .sidebar-inner { padding: 1rem; }
            .container { padding: 1.5rem; }
        }

        @media (max-width: 576px) {
            .container { padding: 1rem; }
        }

        /* Progress bar */
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: var(--gradient-2);
            z-index: 999;
            transform-origin: left;
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="progress-bar" id="progressBar"></div>

    <div class="app-layout">
        <!-- Sidebar: Table of Contents -->
        <aside class="sidebar">
            <div class="sidebar-inner">
                <nav class="toc">
                    <h2>üìã Table of Contents</h2>
                    <div class="toc-nav">
                        <a href="#project-overview">1. Project Overview</a>
                        <a href="#technology-stack">2. Technology Stack</a>
                        <a href="#project-structure">3. Project Structure</a>
                        <a href="#database-architecture">4. Database Architecture</a>
                        <a href="#core-modules">5. Core Modules</a>
                        <a href="#authentication-login">6. Authentication & Login</a>
                        <a href="#bn-course-module">7. BN Course Module</a>
                        <a href="#level-check-system">8. Level Check System</a>
                        <a href="#phrases-topic-list">9. Phrases Topic List</a>
                        <a href="#admin-panel">10. Admin Panel</a>
                        <a href="#ios-api">11. iOS API</a>
                        <a href="#critical-files">12. Critical Files</a>
                        <a href="#development-setup">13. Development Setup</a>
                        <a href="#laravel-notes">14. Laravel Notes</a>
                    </div>
                </nav>
            </div>
        </aside>

        <!-- Main Content - Full Area -->
        <div class="main-content">
            <div class="container">
                <header class="header">
                    <h1>B-News Project - Knowledge Transfer Document</h1>
                    <p class="subtitle">Complete developer onboarding guide ‚Ä¢ Preserve all content ‚Ä¢ Easy to understand</p>
                </header>

                <main>
            <!-- Project Overview -->
            <section id="project-overview" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üéØ</span> Project Overview</h2>
                
                <h3>Purpose</h3>
                <p><strong>B-News</strong> is a language learning application designed to help users learn English/Japanese through:</p>
                <ul>
                    <li><strong>Podcast-based learning</strong> with transcripts</li>
                    <li><strong>Structured courses</strong> (Framework, Input, Output)</li>
                    <li><strong>Level assessment</strong> system</li>
                    <li><strong>Word & Phrase management</strong> (word lists, phrase lists)</li>
                    <li><strong>Battle mode</strong> (multiplayer vocabulary challenges)</li>
                    <li><strong>Self-test</strong> functionality</li>
                    <li><strong>Shadowing & Thought Composer</strong> exercises</li>
                </ul>

                <h3>Key Features</h3>
                <ul>
                    <li>User registration/login with device management</li>
                    <li>Course progression with lessons and questions</li>
                    <li>Adaptive level checking (binary search algorithm)</li>
                    <li>Word list and phrase list management</li>
                    <li>Cloud list (shared word/phrase lists)</li>
                    <li>Battle mode for competitive learning</li>
                    <li>Admin panel for content management</li>
                    <li>iOS mobile app API</li>
                </ul>
            </section>

            <!-- Technology Stack -->
            <section id="technology-stack" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üíª</span> Technology Stack</h2>
                <ul>
                    <li><strong>Backend</strong>: Core PHP (Procedural PHP, NOT Laravel)</li>
                    <li><strong>Database</strong>: MySQL (stega_staging_new)</li>
                    <li><strong>Server</strong>: Apache (XAMPP for local)</li>
                    <li><strong>Cloud</strong>: AWS (S3, CloudFront, Secrets Manager)</li>
                    <li><strong>Frontend</strong>: jQuery, Bootstrap 3.x</li>
                    <li><strong>API Format</strong>: JSON</li>
                    <li><strong>Authentication</strong>: SHA1 password hashing, session-based admin auth</li>
                </ul>
            </section>

            <!-- Project Structure -->
            <section id="project-structure" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üìÅ</span> Project Structure</h2>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>B-News/
‚îú‚îÄ‚îÄ common.php                    # Main database connection & constants
‚îú‚îÄ‚îÄ constant.php                  # ReCaptcha keys & config
‚îú‚îÄ‚îÄ login.php                     # Root login (redirects to admin)
‚îú‚îÄ‚îÄ login_handler.php             # Root login handler
‚îÇ
‚îú‚îÄ‚îÄ bn-controlpanel/              # ADMIN PANEL
‚îÇ   ‚îú‚îÄ‚îÄ login.php                 # Admin login page
‚îÇ   ‚îú‚îÄ‚îÄ login_handler.php         # Admin login handler
‚îÇ   ‚îú‚îÄ‚îÄ dashboard.php             # Admin dashboard
‚îÇ   ‚îú‚îÄ‚îÄ bn_course.php             # Course management UI
‚îÇ   ‚îú‚îÄ‚îÄ level_check.php           # Level check management UI
‚îÇ   ‚îú‚îÄ‚îÄ phrases_topic_list.php    # Phrases list management
‚îÇ   ‚îú‚îÄ‚îÄ lesson.php                # Lesson management
‚îÇ   ‚îú‚îÄ‚îÄ lesson-questions.php      # Question management
‚îÇ   ‚îî‚îÄ‚îÄ ... (other admin files)
‚îÇ
‚îú‚îÄ‚îÄ webservice_1_18_1_ios/        # iOS API ENDPOINTS
‚îÇ   ‚îú‚îÄ‚îÄ common.php                # API common functions
‚îÇ   ‚îú‚îÄ‚îÄ user_login.php            # User login API
‚îÇ   ‚îú‚îÄ‚îÄ registration.php          # User registration API
‚îÇ   ‚îú‚îÄ‚îÄ get-bn-coursedata.php     # Get course structure
‚îÇ   ‚îú‚îÄ‚îÄ level_check_start.php     # Start level check
‚îÇ   ‚îú‚îÄ‚îÄ level_check_submit.php    # Submit level check answers
‚îÇ   ‚îú‚îÄ‚îÄ level_check_result.php    # Get level check results
‚îÇ   ‚îú‚îÄ‚îÄ get_phraseslist.php       # Get phrases lists
‚îÇ   ‚îú‚îÄ‚îÄ set_phraseslist.php       # Save phrases list
‚îÇ   ‚îî‚îÄ‚îÄ ... (other API endpoints)
‚îÇ
‚îú‚îÄ‚îÄ v1/common/                    # Shared functions
‚îÇ   ‚îî‚îÄ‚îÄ function.php              # Core utility functions
‚îÇ
‚îú‚îÄ‚îÄ stega_staging_new.sql         # Database dump (3.6M+ lines)
‚îÇ
‚îî‚îÄ‚îÄ ... (other directories)</code></pre>
                </div>
            </section>

            <!-- Database Architecture -->
            <section id="database-architecture" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üóÑÔ∏è</span> Database Architecture</h2>
                
                <h3>Key Tables</h3>
                
                <h4>User Management</h4>
                <ul>
                    <li><code>tbl_user</code> - User accounts (user_id, username, email, password, device_id, device_token, user_level, etc.)</li>
                    <li><code>tbl_deleted_user</code> - Soft-deleted users</li>
                    <li><code>admin_login</code> - Admin panel users</li>
                </ul>

                <h4>Course System</h4>
                <ul>
                    <li><code>bn_course_questions</code> - Course questions (lesson_id, question_type, options, correct_answer, audio_path, etc.)</li>
                    <li><code>bn_level_check_sessions</code> - Level check sessions (user_id, status, current_index, result_lesson_id, etc.)</li>
                    <li><code>bn_level_check_answers</code> - Level check answers (session_id, question_id, selected_answer, is_correct)</li>
                </ul>

                <h4>Word & Phrase Lists</h4>
                <ul>
                    <li><code>tbl_newwordlist</code> - User word lists (user_id, listname, list_id)</li>
                    <li><code>tbl_wordlist</code> - Words in lists (wordname, define, learnedcount, etc.)</li>
                    <li><code>tbl_phrases_list</code> - Phrase lists (phrases_id, name, subtitle, list_level)</li>
                    <li><code>tbl_phraseslist_word</code> - Phrases in lists (phrases_id, eng_phrase, jpn_phrase)</li>
                    <li><code>tbl_user_phraseslist</code> - User's phrase lists</li>
                    <li><code>tbl_user_phrases</code> - User's phrases</li>
                </ul>

                <h4>Content</h4>
                <ul>
                    <li><code>essay</code> - Essay content</li>
                    <li><code>product</code> - Product/episode content</li>
                    <li><code>tbl_rss_mst</code> - RSS feed data</li>
                </ul>

                <h4>Battle Mode</h4>
                <ul>
                    <li><code>tbl_battle_mst</code> - Battle sessions</li>
                    <li><code>tbl_battle_friend_list</code> - Battle participants</li>
                    <li><code>tbl_battle_words</code> - Battle words</li>
                </ul>

                <h4>Other</h4>
                <ul>
                    <li><code>device_registration</code> - Device tokens for push notifications</li>
                    <li><code>settings</code> - System settings</li>
                    <li><code>tbl_friend</code> - User friendships</li>
                </ul>
            </section>

            <!-- Core Modules (placeholder - content flows from TOC) -->
            <section id="core-modules" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üîß</span> Core Modules</h2>
                <p>The core modules are covered in detail in the following sections: Authentication, BN Course, Level Check, Phrases, Admin Panel, and iOS API.</p>
            </section>

            <!-- Authentication & Login -->
            <section id="authentication-login" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üîê</span> Authentication & Login</h2>
                
                <h3>Admin Panel Login</h3>
                <p><strong>Files</strong>: <code>bn-controlpanel/login.php</code>, <code>bn-controlpanel/login_handler.php</code></p>
                
                <div class="flow-box">
                    <strong>Flow:</strong>
                    <ol>
                        <li>Admin enters username/password</li>
                        <li>Password is SHA1 hashed</li>
                        <li>Query: <code>SELECT * FROM admin_login WHERE username='...' AND password='...'</code></li>
                        <li>On success: Set <code>$_SESSION['admin_username']</code></li>
                        <li>Redirect to <code>dashboard.php</code></li>
                    </ol>
                </div>

                <p><strong>Security</strong>:</p>
                <ul>
                    <li>ReCaptcha (commented out in current code)</li>
                    <li>Session-based authentication</li>
                    <li><code>check_user_is_login()</code> function validates admin sessions</li>
                </ul>

                <h3>User Login (iOS API)</h3>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/user_login.php</code></p>
                
                <div class="flow-box">
                    <strong>Flow:</strong>
                    <ol>
                        <li>POST: <code>username</code> (email or username), <code>password</code>, <code>device_id</code>, <code>device_token</code></li>
                        <li>Password SHA1 hashed</li>
                        <li>Query: <code>SELECT * FROM tbl_user WHERE (email='...' OR username='...') AND password='...'</code></li>
                        <li>Check user status (0=unverified, 1=verified)</li>
                        <li>Update device_id and device_token</li>
                        <li>Return user data + word lists + phrase lists</li>
                    </ol>
                </div>

                <h4>Response Format</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>{
  "status_code": 4,
  "msg": "Login successful.",
  "user_id": 123,
  "username": "...",
  "email": "...",
  "word_data": {...},
  "word_list": [...],
  "phrases_data": {...},
  "phrases_list": [...]
}</code></pre>
                </div>
            </section>

            <!-- BN Course Module -->
            <section id="bn-course-module" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üìö</span> BN Course Module</h2>
                
                <h3>Course Structure</h3>
                <p><strong>File</strong>: <code>course-data.json</code> (or loaded via <code>getCourseData()</code> function)</p>
                
                <h4>Hierarchy</h4>
                <div class="tree">
Section (id, title, color)<br>
&nbsp;&nbsp;‚îî‚îÄ‚îÄ Chapter (id, title, category)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚îî‚îÄ‚îÄ Lesson (id, title, description, question_type, s3_folder_name)
                </div>

                <h4>Sections</h4>
                <ul>
                    <li><strong>Framework</strong> (id: 1, color: #FFBE5C) - Grammar structure lessons</li>
                    <li><strong>Input</strong> (id: 2, color: #89A8DC) - Listening exercises</li>
                    <li><strong>Output</strong> (id: 3, color: #E59E9E) - Shadowing, Thought Composer</li>
                </ul>

                <h4>Question Types</h4>
                <ul>
                    <li><code>single_choice</code> - Multiple choice questions</li>
                    <li><code>question_with_audio</code> - Audio-based questions (CloudFront signed URLs)</li>
                    <li><code>multisteps</code> - Multi-step questions</li>
                </ul>

                <h3>Key Functions</h3>
                <ul>
                    <li><code>getCourseData()</code> - Returns full course structure from database/JSON</li>
                    <li><code>findLessonWithContext($course, $lesson_id)</code> - Find lesson with chapter/section info</li>
                    <li><code>getChapterNumber($chapter_id)</code> - Get chapter number</li>
                    <li><code>getLessonNumber($lesson_id)</code> - Get lesson number</li>
                </ul>

                <h3>Admin Panel Course Management</h3>
                <p><strong>File</strong>: <code>bn-controlpanel/bn_course.php</code></p>
                <p><strong>Features</strong>:</p>
                <ul>
                    <li>View course structure (expandable sections/chapters/lessons)</li>
                    <li>Color-coded sections</li>
                    <li>Link to lesson management</li>
                    <li>Question management per lesson</li>
                </ul>
            </section>

            <!-- Level Check System -->
            <section id="level-check-system" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üéØ</span> Level Check System</h2>
                
                <h3>Purpose</h3>
                <p>Adaptive assessment to determine user's English level using binary search algorithm.</p>

                <h3>Flow</h3>

                <h4>1. Start Level Check</h4>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/level_check_start.php</code></p>
                <p><strong>Process</strong>:</p>
                <ul>
                    <li>Creates/resumes session in <code>bn_level_check_sessions</code></li>
                    <li>Selects lessons from Framework (id:1) and Input (id:2) sections only</li>
                    <li>Starts at middle lesson (or Chapter 106 if exists)</li>
                    <li>Fetches 4 questions from current lesson</li>
                    <li>Uses binary search bounds: <code>low_index</code>, <code>high_index</code>, <code>current_index</code></li>
                </ul>

                <h4>Response</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>{
  "success": true,
  "session": {
    "session_id": 123,
    "current_index": 50,
    "bounds": {"low_index": 0, "high_index": 100}
  },
  "questions": [...]
}</code></pre>
                </div>

                <h4>2. Submit Answers</h4>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/level_check_submit.php</code></p>
                <p><strong>Algorithm</strong>:</p>
                <ul>
                    <li>User answers 4 questions</li>
                    <li>If ‚â•3 correct ‚Üí Move UP (harder lesson)</li>
                    <li>If &lt;3 correct ‚Üí Move DOWN (easier lesson)</li>
                    <li>Updates <code>low_index</code> or <code>high_index</code> accordingly</li>
                    <li><strong>Category Coverage</strong>: Ensures questions from different categories (listening, grammar, etc.)</li>
                    <li><strong>Stopping Condition</strong>: After 20 questions answered OR bounds converge</li>
                </ul>

                <h4>Binary Search Logic</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>if ($correctCount >= 3) {
    $lowIndex = max($lowIndex, $currentIndex + 1);
    $nextIndex = $currentIndex + 1; // Move up
} else {
    $nextIndex = $currentIndex - 1; // Move down
}</code></pre>
                </div>

                <h4>3. Completion</h4>
                <p>When stopping condition met:</p>
                <ul>
                    <li>Calculate accuracy: <code>(total_correct / total_answered) * 100</code></li>
                    <li>Determine result lesson (midpoint of final bounds)</li>
                    <li>Generate level, achievements, radar chart data</li>
                    <li>Set session status to <code>completed</code></li>
                </ul>

                <h4>Response</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>{
  "success": true,
  "completed": true,
  "result_lesson": {...},
  "summary": {
    "level": "Intermediate",
    "accuracy": 75,
    "achievements": [...]
  },
  "rader_chart_data": {...}
}</code></pre>
                </div>

                <h3>Key Tables</h3>
                <ul>
                    <li><code>bn_level_check_sessions</code> - Session tracking</li>
                    <li><code>bn_level_check_answers</code> - Answer storage</li>
                </ul>

                <h3>Admin Panel</h3>
                <p><strong>File</strong>: <code>bn-controlpanel/level_check.php</code> - View level check history and results</p>
            </section>

            <!-- Phrases Topic List Module -->
            <section id="phrases-topic-list" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üìù</span> Phrases Topic List Module</h2>
                
                <h3>Purpose</h3>
                <p>Users can create and manage phrase lists (English-Japanese phrases).</p>

                <h3>Database Tables</h3>
                <ul>
                    <li><code>tbl_phrases_list</code> - Master phrase lists (admin-created)</li>
                    <li><code>tbl_phraseslist_word</code> - Phrases in lists (eng_phrase, jpn_phrase)</li>
                    <li><code>tbl_user_phraseslist</code> - User's phrase lists</li>
                    <li><code>tbl_user_phrases</code> - User's phrases</li>
                </ul>

                <h3>API Endpoints</h3>

                <h4>Get Phrases Lists</h4>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/get_phraseslist.php</code></p>
                <ul>
                    <li>Returns all active phrase lists with word counts</li>
                    <li>Includes learned count per user</li>
                </ul>

                <h4>Save Phrases List</h4>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/set_phraseslist.php</code></p>
                <ul>
                    <li>Creates/updates user phrase list</li>
                    <li>Syncs phrases from master list</li>
                </ul>

                <h4>Get Phrases Words</h4>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/get_phraseslist_word.php</code></p>
                <ul>
                    <li>Returns phrases in a specific list</li>
                </ul>

                <h3>Admin Panel</h3>
                <p><strong>File</strong>: <code>bn-controlpanel/phrases_topic_list.php</code></p>
                <p><strong>Features</strong>:</p>
                <ul>
                    <li>View all phrase lists</li>
                    <li>Add/Edit/Delete phrase lists</li>
                    <li>Upload via Excel spreadsheet</li>
                    <li>Set list level (Beginner/Intermediate/Expert)</li>
                    <li>Manage phrases in each list</li>
                    <li>Import from S3</li>
                </ul>
            </section>

            <!-- Admin Panel -->
            <section id="admin-panel" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üéõÔ∏è</span> Admin Panel</h2>
                
                <h3>Location</h3>
                <p><code>bn-controlpanel/</code> directory</p>

                <h3>Key Pages</h3>
                <ul>
                    <li><code>dashboard.php</code> - Main dashboard with sidebar navigation</li>
                    <li><code>login.php</code> / <code>login_handler.php</code> - Admin authentication</li>
                    <li><code>bn_course.php</code> - Course structure management</li>
                    <li><code>lesson.php</code> - Lesson management</li>
                    <li><code>lesson-questions.php</code> - Question CRUD</li>
                    <li><code>level_check.php</code> - Level check history viewer</li>
                    <li><code>phrases_topic_list.php</code> - Phrases management</li>
                    <li><code>manage_users.php</code> - User management</li>
                    <li><code>battle_dashboad.php</code> - Battle mode dashboard</li>
                </ul>

                <h3>Authentication</h3>
                <ul>
                    <li>Session-based: <code>$_SESSION['admin_username']</code></li>
                    <li>Function: <code>check_user_is_login()</code> - Validates admin session</li>
                </ul>

                <h3>Common Functions</h3>
                <p><strong>File</strong>: <code>v1/common/function.php</code></p>
                <ul>
                    <li><code>check_user_is_login()</code> - Admin session check</li>
                    <li><code>getCourseData()</code> - Load course structure</li>
                    <li><code>log_msg()</code> - Logging utility</li>
                    <li>Database helper functions</li>
                </ul>
            </section>

            <!-- iOS API -->
            <section id="ios-api" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üì±</span> iOS API (webservice_1_18_1_ios)</h2>
                
                <h3>Base URL</h3>
                <ul>
                    <li>Local: <code>http://localhost/B-News/webservice_1_18_1_ios/</code></li>
                    <li>Production: <code>https://newstaging.stega.jp/webservice_1_18_1_ios/</code></li>
                </ul>

                <h3>Common File</h3>
                <p><strong>File</strong>: <code>webservice_1_18_1_ios/common.php</code></p>
                <p><strong>Key Functions</strong>:</p>
                <ul>
                    <li><code>is_require($array, $field)</code> - Validate required fields</li>
                    <li><code>_getStatusCodeMessage($code)</code> - Error messages</li>
                    <li><code>_sendResponse($status_code)</code> - Standard JSON response</li>
                    <li><code>get_friendList($user_id)</code> - Get user's friends</li>
                    <li><code>get_user_info($user_id)</code> - Get user data</li>
                </ul>

                <h3>Key Endpoints</h3>

                <h4>Authentication</h4>
                <ul>
                    <li><code>user_login.php</code> - User login</li>
                    <li><code>registration.php</code> - User registration</li>
                </ul>

                <h4>Course</h4>
                <ul>
                    <li><code>get-bn-coursedata.php</code> - Get course structure + level check history</li>
                    <li><code>get-bn-course-lessonData.php</code> - Get lesson details</li>
                    <li><code>get-bn-course-question-list.php</code> - Get questions for lesson</li>
                </ul>

                <h4>Level Check</h4>
                <ul>
                    <li><code>level_check_start.php</code> - Start level check session</li>
                    <li><code>level_check_submit.php</code> - Submit answers</li>
                    <li><code>level_check_result.php</code> - Get results</li>
                    <li><code>level_check_history.php</code> - Get history</li>
                </ul>

                <h4>Phrases</h4>
                <ul>
                    <li><code>get_phraseslist.php</code> - Get all phrase lists</li>
                    <li><code>get_phraseslist_word.php</code> - Get phrases in list</li>
                    <li><code>set_phraseslist.php</code> - Save user phrase list</li>
                    <li><code>get_myphrasesList.php</code> - Get user's phrase lists</li>
                </ul>

                <h4>Words</h4>
                <ul>
                    <li><code>get_wordList.php</code> - Get word lists</li>
                    <li><code>set_wordlist.php</code> - Save word list</li>
                    <li><code>get_cloudlist.php</code> - Get cloud lists</li>
                </ul>

                <h4>Other</h4>
                <ul>
                    <li><code>update_profile.php</code> - Update user profile</li>
                    <li><code>shadowing.php</code> - Shadowing exercises</li>
                    <li><code>user_xp.php</code> - XP/level system</li>
                    <li><code>bonus_episode.php</code> - Bonus content</li>
                </ul>

                <h3>Response Format</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>{
  "status_code": 200,
  "msg": "Ok.",
  "data": {...}
}</code></pre>
                </div>
            </section>

            <!-- Critical Files -->
            <section id="critical-files" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üîß</span> Critical Files & Functions</h2>
                
                <h3>Database Connection</h3>
                <p><strong>File</strong>: <code>common.php</code></p>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>// Local
$conn = mysqli_connect("localhost", "root", "", "stega_staging_new", 3306);

// Production
$conn = mysqli_connect("stega-tokyo.cuaebcrgemut.ap-northeast-1.rds.amazonaws.com", 
                       "StegaJp", "StegaJp321", "stega_staging_new", 3308);</code></pre>
                </div>

                <h3>Constants</h3>
                <p><strong>File</strong>: <code>common.php</code></p>
                <ul>
                    <li><code>BASE_URL</code> - API base URL</li>
                    <li><code>USER_PROFILE_PATH</code> - User profile image path</li>
                    <li><code>MAIN_URL</code> - Main application URL</li>
                    <li><code>ADMIN_URL</code> - Admin panel URL</li>
                </ul>

                <h3>Course Data Function</h3>
                <p><strong>File</strong>: <code>v1/common/function.php</code></p>
                <ul>
                    <li><code>getCourseData()</code> - Loads course structure from database/JSON</li>
                    <li>Returns array: <code>[sections => [chapters => [lessons]]]</code></li>
                </ul>

                <h3>AWS Integration</h3>
                <ul>
                    <li><strong>CloudFront</strong>: Signed URLs for audio files</li>
                    <li><strong>S3</strong>: Audio file storage</li>
                    <li><strong>Secrets Manager</strong>: Private keys for CloudFront signing</li>
                    <li>Functions: <code>fetchPrivateKeyFromSecretsCached()</code>, <code>generateSignedCloudFrontUrlCached()</code></li>
                </ul>
            </section>

            <!-- Development Setup -->
            <section id="development-setup" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üöÄ</span> Development Setup</h2>
                
                <h3>Local Setup</h3>
                <ol>
                    <li><strong>XAMPP</strong> installed</li>
                    <li><strong>Database</strong>: Import <code>stega_staging_new.sql</code></li>
                    <li><strong>Config</strong>: Update <code>common.php</code> for local DB connection</li>
                    <li><strong>URL</strong>: <code>http://localhost/B-News/</code></li>
                </ol>

                <h3>Environment Detection</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>if ($_SERVER['SERVER_NAME'] == 'localhost' || 
    $_SERVER['SERVER_NAME'] == '127.0.0.1' || 
    $_SERVER['SERVER_NAME'] == '192.168.0.183') {
    // Local environment
} else {
    // Production environment
}</code></pre>
                </div>

                <h3>Database Connection</h3>
                <ul>
                    <li><strong>Local</strong>: Port 3306, no password</li>
                    <li><strong>Production</strong>: Port 3308, AWS RDS</li>
                </ul>
            </section>

            <!-- Laravel Notes -->
            <section id="laravel-notes" class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">‚ö†Ô∏è</span> Important Notes for Laravel Developers</h2>
                
                <h3>Differences from Laravel</h3>

                <ol>
                    <li><strong>No MVC Pattern</strong>
                        <ul>
                            <li>Procedural PHP, not OOP</li>
                            <li>No Controllers, Models, Routes</li>
                            <li>Direct file access: <code>webservice_1_18_1_ios/user_login.php</code></li>
                        </ul>
                    </li>
                    <li><strong>No Eloquent ORM</strong>
                        <ul>
                            <li>Raw MySQLi queries: <code>mysqli_query($conn, "SELECT ...")</code></li>
                            <li>Manual parameter binding: <code>$stmt->bind_param('i', $user_id)</code></li>
                        </ul>
                    </li>
                    <li><strong>No Blade Templates</strong>
                        <ul>
                            <li>Inline PHP/HTML: <code>&lt;?php echo $data; ?&gt;</code></li>
                            <li>No template inheritance</li>
                        </ul>
                    </li>
                    <li><strong>No Artisan/Composer Autoloading</strong>
                        <ul>
                            <li>Manual includes: <code>require_once '../common.php'</code></li>
                            <li>No namespace usage</li>
                        </ul>
                    </li>
                    <li><strong>No Middleware</strong>
                        <ul>
                            <li>Manual auth checks: <code>check_user_is_login()</code></li>
                            <li>Session handling: <code>$_SESSION['admin_username']</code></li>
                        </ul>
                    </li>
                    <li><strong>No Validation Classes</strong>
                        <ul>
                            <li>Manual validation: <code>is_require($_POST, 'user_id')</code></li>
                            <li>Custom error messages</li>
                        </ul>
                    </li>
                    <li><strong>No API Resources</strong>
                        <ul>
                            <li>Manual JSON encoding: <code>echo json_encode($result)</code></li>
                            <li>Custom response formats</li>
                        </ul>
                    </li>
                    <li><strong>No Migrations</strong>
                        <ul>
                            <li>Direct SQL execution</li>
                            <li>Database changes via SQL files</li>
                        </ul>
                    </li>
                </ol>

                <h3>Common Patterns</h3>

                <h4>Database Query Pattern</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>$query = mysqli_query($conn, "SELECT * FROM tbl_user WHERE user_id = $user_id");
if (mysqli_num_rows($query) > 0) {
    $row = mysqli_fetch_assoc($query);
    // Process data
}</code></pre>
                </div>

                <h4>Prepared Statement Pattern</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>$stmt = $con->prepare("SELECT * FROM tbl_user WHERE user_id = ?");
$stmt->bind_param('i', $user_id);
$stmt->execute();
$result = $stmt->get_result();
$row = $result->fetch_assoc();
$stmt->close();</code></pre>
                </div>

                <h4>Response Pattern</h4>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code>$result = array(
    'status_code' => 200,
    'msg' => 'Success',
    'data' => $data
);
echo json_encode($result);</code></pre>
                </div>

                <h3>Security Considerations</h3>
                <ul>
                    <li><strong>SQL Injection</strong>: Use prepared statements (some old code may have vulnerabilities)</li>
                    <li><strong>XSS</strong>: Manual escaping needed</li>
                    <li><strong>CSRF</strong>: No built-in protection (consider adding tokens)</li>
                    <li><strong>Password Hashing</strong>: SHA1 (consider upgrading to bcrypt)</li>
                </ul>
            </section>

            <!-- Module Priority -->
            <section class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üìä</span> Module Priority (Critical to Less Critical)</h2>
                
                <h3><span class="badge badge-critical">üî¥ Critical Modules</span></h3>
                <ol>
                    <li><strong>Login/Authentication</strong> - Core functionality</li>
                    <li><strong>BN Course Module</strong> - Main learning content</li>
                    <li><strong>Level Check System</strong> - User assessment</li>
                    <li><strong>Database Connection</strong> - <code>common.php</code></li>
                </ol>

                <h3><span class="badge badge-important">üü° Important Modules</span></h3>
                <ol start="5">
                    <li><strong>Phrases Topic List</strong> - User content management</li>
                    <li><strong>Word Lists</strong> - User vocabulary</li>
                    <li><strong>Admin Panel</strong> - Content management</li>
                </ol>

                <h3><span class="badge badge-supporting">üü¢ Supporting Modules</span></h3>
                <ol start="8">
                    <li><strong>Battle Mode</strong> - Gamification</li>
                    <li><strong>Push Notifications</strong> - User engagement</li>
                    <li><strong>RSS/Episodes</strong> - Content delivery</li>
                </ol>
            </section>

            <!-- Quick Reference -->
            <section class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üîç</span> Quick Reference</h2>
                
                <h3>Find Course Data</h3>
                <ul>
                    <li>Function: <code>getCourseData()</code> in <code>v1/common/function.php</code></li>
                    <li>Admin UI: <code>bn-controlpanel/bn_course.php</code></li>
                    <li>API: <code>webservice_1_18_1_ios/get-bn-coursedata.php</code></li>
                </ul>

                <h3>Find Level Check Logic</h3>
                <ul>
                    <li>Start: <code>webservice_1_18_1_ios/level_check_start.php</code></li>
                    <li>Submit: <code>webservice_1_18_1_ios/level_check_submit.php</code></li>
                    <li>Result: <code>webservice_1_18_1_ios/level_check_result.php</code></li>
                </ul>

                <h3>Find Phrases Management</h3>
                <ul>
                    <li>Admin: <code>bn-controlpanel/phrases_topic_list.php</code></li>
                    <li>API List: <code>webservice_1_18_1_ios/get_phraseslist.php</code></li>
                    <li>API Save: <code>webservice_1_18_1_ios/set_phraseslist.php</code></li>
                </ul>

                <h3>Find User Login</h3>
                <ul>
                    <li>Admin: <code>bn-controlpanel/login_handler.php</code></li>
                    <li>User: <code>webservice_1_18_1_ios/user_login.php</code></li>
                </ul>
            </section>

            <!-- Additional Resources -->
            <section class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üìù</span> Additional Resources</h2>
                <ul>
                    <li><strong>Database Schema</strong>: Check <code>stega_staging_new.sql</code> for table structures</li>
                    <li><strong>Course Structure</strong>: Check <code>course-data.json</code> (if exists) or database</li>
                    <li><strong>AWS Config</strong>: Check <code>v1/common/function.php</code> for AWS integration</li>
                    <li><strong>Constants</strong>: Check <code>common.php</code> and <code>constant.php</code></li>
                </ul>
            </section>

            <!-- Learning Path -->
            <section class="section section-card animate-on-scroll">
                <h2 class="section-title"><span class="icon">üéì</span> Learning Path for New Developers</h2>
                
                <h3>1. Start Here</h3>
                <ul>
                    <li>Read <code>common.php</code> - Understand DB connection</li>
                    <li>Read <code>webservice_1_18_1_ios/common.php</code> - Understand API patterns</li>
                    <li>Read <code>v1/common/function.php</code> - Understand utility functions</li>
                </ul>

                <h3>2. Then Explore</h3>
                <ul>
                    <li>User login flow (<code>user_login.php</code>)</li>
                    <li>Course structure (<code>getCourseData()</code>)</li>
                    <li>Level check (<code>level_check_start.php</code>, <code>level_check_submit.php</code>)</li>
                </ul>

                <h3>3. Admin Panel</h3>
                <ul>
                    <li>Admin login (<code>bn-controlpanel/login_handler.php</code>)</li>
                    <li>Course management (<code>bn-controlpanel/bn_course.php</code>)</li>
                    <li>Question management (<code>bn-controlpanel/lesson-questions.php</code>)</li>
                </ul>

                <h3>4. Database</h3>
                <ul>
                    <li>Review key tables in <code>stega_staging_new.sql</code></li>
                    <li>Understand relationships between tables</li>
                </ul>
            </section>

            <!-- Footer -->
            <footer class="footer animate-on-scroll">
                <p><strong>Document Version</strong>: 1.0</p>
                <p><strong>Last Updated</strong>: February 2026</p>
                <p><strong>Prepared For</strong>: Senior Laravel Developer (3 years experience)</p>
            </footer>
                </main>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-php.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-json.min.js"></script>
    <script>
        // Scroll progress bar
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressBar').style.width = scrolled + '%';
        });

        // Intersection Observer for scroll animations
        const observerOptions = { threshold: 0.1, rootMargin: '0px 0px -50px 0px' };
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, observerOptions);

        document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));

        // Copy code functionality
        function copyCode(btn) {
            const pre = btn.parentElement.querySelector('pre code');
            const text = pre.textContent;
            navigator.clipboard.writeText(text).then(() => {
                const original = btn.textContent;
                btn.textContent = 'Copied!';
                btn.style.background = 'var(--accent-green)';
                btn.style.color = 'var(--bg-dark)';
                setTimeout(() => {
                    btn.textContent = original;
                    btn.style.background = '';
                    btn.style.color = '';
                }, 2000);
            });
        }

        // Smooth scroll for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
        });

        // Highlight active section in TOC
        const sections = document.querySelectorAll('section[id]');
        const tocLinks = document.querySelectorAll('.toc-nav a');

        window.addEventListener('scroll', () => {
            let current = '';
            sections.forEach(section => {
                const top = section.offsetTop;
                const height = section.offsetHeight;
                if (scrollY >= top - 150) current = section.getAttribute('id');
            });
            tocLinks.forEach(link => {
                link.style.background = '';
                link.style.color = '';
                if (link.getAttribute('href') === '#' + current) {
                    link.style.background = 'var(--bg-elevated)';
                    link.style.color = 'var(--accent-cyan)';
                }
            });
        });
    </script>
</body>
</html>
